$("._tab").click(function() {
    let tabId = $(this).attr("data-tab")
    if(tabId == 'disabled'){
        return
    }
    let parentBlock = $(this).parents("._tabs-parent")

    console.log(parentBlock)
    $(parentBlock).find("._tab").removeClass("_active")
    $(this).addClass("_active")
    $(parentBlock).find(".tab-content").slideUp(300)
    $(parentBlock).find(`.${tabId}`).slideDown(300)

    setActiveTab($(this).parents(".tabs"))
    $(this).parents(".tabs").removeClass("_active")
})

$(".tabs").each(function(i, el) {
    setActiveTab(el)
})

$(document).mouseup(function(e) {
    var div = $('.tabs');
    if (!div.is(e.target) && div.has(e.target).length === 0) {
        if ($(div).hasClass("_active")) {
            $(div).removeClass("_active")
        }
    }
});

function setActiveTab(el) {
    $(el).find(".tabs__current").html(
        $(el).find("._tab._active").html()
    )
}

$(".tabs__current").click(function() {
    $(this).parents(".tabs").toggleClass("_active")
})

$(".favourite-btn").click(function() {
    $(this).toggleClass("_added")
    let newsLikes = $("._likes-count").html()
    if(newsLikes){
        if($(this).hasClass("_added")){
            $("._likes-count").html(+newsLikes + 1)
        } else{
            $("._likes-count").html(+newsLikes - 1)
        }
    }

})

$(".comparison-btn").click(function() {
    $(this).toggleClass("_added")
})

function cartCalc() {
    $('.cartcalc .ccalc-minus').click(function(e) {
        let a = $(this).closest('.cartcalc').find('input').val();
        if (a > 1) {
            let b = +a - 1;
            $(this).closest('.cartcalc').find('input').val(b);
            $(this).closest('.cartcalc').find('input').trigger('change');
        } else {
            $(this).closest('.cartcalc').find('input').val(a);
        }
        e.stopImmediatePropagation()
    });
    $('.cartcalc .ccalc-plus').click(function(e) {
        let a = $(this).closest('.cartcalc').find('input').val();
        let b = +a + 1;
        $(this).closest('.cartcalc').find('input').val(b);
        $(this).closest('.cartcalc').find('input').trigger('change');
        e.stopImmediatePropagation()
    });
    $('.cartcalc input').change(function () {
        console.log("changed")
    })
}

cartCalc()

let fancybox = document.querySelectorAll("[data-fancybox]")

Fancybox.defaults.placeFocusBack = false

$(".rating-input__item").click(function() {
    let ratingItem = parseInt($(this).attr("data-rating-value"))
    $(this).parent(".rating-input").attr("data-total-rating", ratingItem)
    $(this).siblings(".rating-input__field").val(ratingItem)
})

$(".burger").click(function () {
    $(".header").toggleClass("_open")
    $("body").toggleClass("fixed-body")
})

$(".header-city__btn").click(function () {
    $(".header-city").toggleClass("_active")
})

$(document).mouseup(function(e) {
    var div = $('.header-city');
    if (!div.is(e.target) && div.has(e.target).length === 0) {
        if($(div).hasClass("_active")){
            $(div).removeClass("_active")
        }
    }
});


$(".catalog-menu__toggle").click(function () {
    $(".catalog-menu__mob-view").slideToggle()
})

$(".catalog-dropdown__close").click(function () {
    $(".catalog-menu__group").removeClass("_active")
    $("body").removeClass("fixed-body")
})



$(".catalog-menu__group").hover(onInMenu, onOutMenu);

function onInMenu() {
    if (window.innerWidth > 992) {
        let el = $(this)
        setTimeout(function() {
            if (el.is(':hover')) {
                $(".catalog-menu__group").removeClass("_active")
                el.addClass("_active")
            }
        }, 100);
    }
}

function onOutMenu() {
    if (window.innerWidth > 992) {
        let el = $(this)
        setTimeout(function() {
            if (!el.is(':hover')) {
                el.removeClass("_active")
            }
        }, 200);
    }
}


$(".catalog-menu__show").click(function () {
    if(window.innerWidth<=992){
        $(".catalog-menu__group").removeClass("_active")
        $(this).parents(".catalog-menu__group").toggleClass("_active")
        $("body").addClass("fixed-body")
    }
})

$(document).mouseup(function(e) {
    var div = $('.catalog-menu__group');
    if (!div.is(e.target) && div.has(e.target).length === 0) {
        if($(div).hasClass("_active")){
            $(div).removeClass("_active")
        }
    }
});


$(".catalog-dropdown__group").hover(onIn, onOut);

function onIn() {
    let imgSrc = $(this).find(".catalog-dropdown__title").attr("data-img")
    $(this).parents(".catalog-dropdown").find(`.catalog-dropdown__icon-wrap`).removeClass("_active")
    $(this).parents(".catalog-dropdown").find(`.catalog-dropdown__icon-wrap[data-img="${imgSrc}"]`).addClass("_active")
}

function onOut() {
    // $(this).parents(".catalog-dropdown").find(".catalog-dropdown__icon img").attr("src","")
}

$(".catalog-dropdown__item-show").click(function () {
    $(this).parents(".catalog-dropdown__item").toggleClass("_active")
    $(this).siblings(".catalog-dropdown__item-hidden").slideToggle()
})

let lastScrollTop = 0;
$(window).scroll(function(){
    setFixHeader()
});

setFixHeader()


function setFixHeader() {
    let headerHeight = document.querySelector(".header").getBoundingClientRect().height
    let st = $(this).scrollTop();
    if(st < headerHeight / 1.5){
        $(".header-top._fixed").removeClass("_fix")
        return
    }
    if (st > lastScrollTop){
        $(".catalog-menu__group").removeClass("_active")
        setTimeout(()=>{
            $(".header-top._fixed").removeClass("_fix")
        },100)
    } else {
        $(".header-top._fixed").addClass("_fix")
    }
    lastScrollTop = st;
}

function bannerSliders() {
    let SlidersArray = []
    $(".banner-slider").each(function(index, el) {
        $(el).attr("data-slider-id", `${index}`)
        let delay = +$(el).attr("data-delay")
        let nextX = $(el).attr("data-x")
        let nextY = $(el).attr("data-y")
        SlidersArray[index] = new Swiper(`.banner-slider[data-slider-id="${index}"] .swiper-container`, {
            slidesPerView: 1,
            spaceBetween: 0,
            loop: true,
            loopedSlides: 1300,
            autoplay: {
                delay: delay,
                disableOnInteraction: false,
                pauseOnMouseEnter: true
            },
            parallax: true,
            speed: 700,
            effect: 'fade',
            fadeEffect: {
                crossFade: true
            },
            pagination: {
                el: `.banner-slider[data-slider-id="${index}"] .swiper-pagination`,
                type: 'bullets',
                clickable: true,
            },
        })
    })
}

function getAutoplaySettings(autoplay) {
    if(autoplay){
        return  {
            delay: 5000,
            // reverseDirection: true,
            pauseOnMouseEnter: true,
            disableOnInteraction: false
        }
    }
    return false
}

function productSliders() {
    let SlidersArray = []
    $(".product-slider").each(function(index, el) {
        let parentSection = $(el).parents("._autoplay")
        $(el).attr("data-slider-id", `${index}`)
        SlidersArray[index] = new Swiper(`.product-slider[data-slider-id="${index}"] .swiper-container`, {
            slidesPerView: "auto",
            spaceBetween: 0,
            watchSlidesProgress: true,
            preventClicks :true,
            a11y: false,
            noSwipingSelector: "button",
            autoplay: getAutoplaySettings(!!parentSection.length),
            navigation: {
                nextEl: `.product-slider[data-slider-id="${index}"] .swiper-button-next`,
                prevEl: `.product-slider[data-slider-id="${index}"] .swiper-button-prev`,
            },
        })
    })
}

function newsSliders() {
    let SlidersArray = []
    $(".news-slider").each(function(index, el) {
        let parentSection = $(el).parents(".certificates,._autoplay")

        $(el).attr("data-slider-id", `${index}`)
        SlidersArray[index] = new Swiper(`.news-slider[data-slider-id="${index}"] .swiper-container`, {
            slidesPerView: "auto",
            spaceBetween: 0,
            // loop: true,
            autoplay: getAutoplaySettings(!!parentSection.length),
            preventClicks :true,
            a11y: false,
            noSwipingSelector: "a",
            navigation: {
                nextEl: `.news-slider[data-slider-id="${index}"] .swiper-button-next`,
                prevEl: `.news-slider[data-slider-id="${index}"] .swiper-button-prev`,
            },
            pagination: {
                el: `.news-slider[data-slider-id="${index}"] .swiper-pagination`,
                type: 'bullets',
                clickable: true,
            },
        })
    })
}

function companiesSliders() {
    let SlidersArray = []
    $(".companies-slider").each(function(index, el) {
        let parentSection = $(el).parents(".companies")
        $(el).attr("data-slider-id", `${index}`)
        SlidersArray[index] = new Swiper(`.companies-slider[data-slider-id="${index}"] .swiper-container`, {
            spaceBetween: 0,
            autoplay: getAutoplaySettings(!!parentSection.length),
            navigation: {
                nextEl: `.companies-slider[data-slider-id="${index}"] .swiper-button-next`,
                prevEl: `.companies-slider[data-slider-id="${index}"] .swiper-button-prev`,
            },
            pagination: {
                el: `.companies-slider[data-slider-id="${index}"] .swiper-pagination`,
                type: 'bullets',
                clickable: true,
            },
            breakpoints: {
                320: {
                    slidesPerView: 2,
                    grid: {
                        fill: 'row',
                        rows: 2,
                    },
                },
                992:{
                    slidesPerView: "auto",
                    grid: {
                        fill: 'row',
                        rows: 1,
                    },
                }
            }
        })
    })
}

function gallerySlider() {
    var swiper = new Swiper('.gallery-slider .swiper-container', {
        slidesPerView: "auto",
        spaceBetween: 0,
        loop: true,
        autoplay: true,
        navigation: {
            nextEl: '.gallery-slider .swiper-button-next',
            prevEl: '.gallery-slider .swiper-button-prev',
        },
    })
}

function certificatesSlider() {
    var swiper = new Swiper('.certificates4-slider .swiper-container', {
        slidesPerView: "auto",
        spaceBetween: 0,
        navigation: {
            nextEl: '.certificates4-slider .swiper-button-next',
            prevEl: '.certificates4-slider .swiper-button-prev',
        },
    })
}

function automatizationSlider() {
    var swiper = new Swiper('.automatization-slider .swiper-container', {
        slidesPerView: "auto",
        spaceBetween: 0,
        // watchSlidesProgress: true,
        // preventClicks :true,
        // a11y: false,
        autoplay: getAutoplaySettings(true),
        navigation: {
            nextEl: '.automatization-slider .swiper-button-next',
            prevEl: '.automatization-slider .swiper-button-prev',
        },
        pagination: {
            el: `.automatization-slider .swiper-pagination`,
            type: 'bullets',
            clickable: true,
        },
    })
}

$(".swiper-slide").on("mousedown", function(e){ e.preventDefault(); e.stopImmediatePropagation(); });

bannerSliders()
productSliders()
newsSliders()
companiesSliders()
gallerySlider()
certificatesSlider()
automatizationSlider()

$(".faq-card__title").click(function () {
    if(window.innerWidth <= 992){
        $(this).parents(".faq-card").toggleClass("_active")
        $(this).siblings(".faq-card__tooltip").slideToggle()
    }
})

$("._show-all-faq").click(function () {
    $(this).parents(".faq").toggleClass("_all")
})

$(".add-btn").click(function () {
    $(this).parents(".product-card").addClass("_added")
})

$(".product-card").each(function(i, el) {
    let price = $(el).find("[data-price]").attr("data-price")
    let price2 = $(el).find("[data-price2]").attr("data-price2")

    if(price2){
        let economyPrice = price2 - price
        let economyPercent = economyPrice / price2
        $(el).find("._percent").html((economyPercent * 100).toFixed())
        $(el).find("._economy").html(economyPrice)
    }
})

$(".stocks-card").each(function(i, el) {
    let price = $(el).find("[data-price]").attr("data-price")
    let price2 = $(el).find("[data-price2]").attr("data-price2")

    if(price2){
        let economyPrice = price2 - price
        let economyPercent = economyPrice / price2
        $(el).find("._percent").html((economyPercent * 100).toFixed())
        $(el).find("._economy").html(economyPrice)
        console.log(economyPrice)
        console.log()
    }
})

$(".history__show-all").click(function () {
    $(".history").addClass("_open-all")
})


$(".certificates4__items .certificate-card").click(function () {
    let tab = +$(this).attr("data-tab")
    console.log(tab)
    if(window.innerWidth>992){
        $(".certificates4-slider .swiper-slide").removeClass("_active")
        $(`.certificates4-slider .swiper-slide:nth-child(${tab})`).addClass("_active")
    }
})



$(".services-item").hover(showService, ()=>{});

function showService() {
    if (window.innerWidth > 992) {
        let el = $(this)
        setTimeout(function() {
            if (el.is(':hover')) {
                $(".services-item").removeClass("_active")
                el.addClass("_active")
            }
        }, 200);
    }
}


$(".services-item").click(function () {
    if(window.innerWidth<=992) {
        $(this).siblings(".services-item").find(".services-item__hidden").hide()
        $(this).find(".services-item__hidden").slideToggle()
    }
})


$("._region").mouseover(function () {
    if(window.innerWidth>992){
        let tab = $(this).attr("data-tab")
        $(`.map-point`).removeClass("_active")
        $(`.map-point[data-tab="${tab}"]`).addClass("_active")
    }
})

$("._region").click(function () {
    if(window.innerWidth<=992){
        let tab = $(this).attr("data-tab")
        $(`.map-point`).removeClass("_active")
        $(`.map-point[data-tab="${tab}"]`).addClass("_active")
    }
})

$("._region").mouseout(function () {
    $(`.map-point`).removeClass("_active")
})

$("._region").each(function (index,el) {
    setMapInfoPosition(el)
})

$(window).scroll(function () {
    $("._region").each(function (index,el) {
        setMapInfoPosition(el)
    })
})
$(window).resize(function () {
    $("._region").each(function (index,el) {
        setMapInfoPosition(el)
    })
})


function setMapInfoPosition(el) {
    let tab = $(el).attr("data-tab")

    $(`.map-point[data-tab="${tab}"]`).css({
        "width":`${el.getBoundingClientRect().width}px`,
        "height":`${el.getBoundingClientRect().height}px`,
        "top":`${el.getBoundingClientRect().y}px`,
        "left":`${el.getBoundingClientRect().x}px`,
    })

}

$(".condition-card").click(function () {
    if(window.innerWidth <= 992){
        $(this).toggleClass("_active")
    }
})

$(document).mouseup(function(e) {
    var div = $('.condition-card');
    if (!div.is(e.target) && div.has(e.target).length === 0) {
        if($(div).hasClass("_active")){
            $(div).removeClass("_active")
        }
    }
});

if (window.matchMedia("(min-width: 993px)").matches) {
    $('._tooltip').hover(function () {
        $('.payment-card__tooltip').toggleClass('_active')
    })
}
if (window.matchMedia("(max-width: 992px)").matches) {
    $('._tooltip').click(function () {
        $('.payment-card__tooltip').toggleClass('_active')
    })
}

if (window.matchMedia("(max-width: 992px)").matches) {
    $('.maintenance-contract__what').click(function () {
        $(this).toggleClass('_active')
    })
}
$(document).mouseup(function(e) {
    var div = $('.maintenance-contract__what');
    if (!div.is(e.target) && div.has(e.target).length === 0) {
        if($(div).hasClass("_active")){
            $(div).removeClass("_active")
        }
    }
});

let maps = document.querySelectorAll(".contact-card__map")

maps.forEach(map => {
    ymaps.ready(init);
    console.log(map.dataset)

    let coord = [+map.dataset.map, +map.dataset.map2]

    function init() {
        let myMap = new ymaps.Map(map, {
            center: coord,
            zoom: 16,
            controls: []
        });

        var myPlacemark = new ymaps.Placemark(coord, null, {
            preset: 'islands#redCircleDotIcon'
        });
        myMap.geoObjects.add(myPlacemark);

        myMap.behaviors.disable('scrollZoom');

    }
})










$(".case-card").click(function () {
    let tabId = $(this).attr("data-tab")

    $(".examples__view").slideUp(300)
    $(`.${tabId}`).slideDown(300)
})

$(window).on('load resize', function(){
    if ($(window).width() <= 992) {
        $('.footer .socials').insertAfter('.footer__group._additional .footer__links');
    } else{
        $('.footer .socials').insertAfter('.footer__group._contacts .footer__contacts-item:last-child');
    }
});

$("._show-all-reviews").click(function () {
    $(".review-card._new").fadeIn(300)
})

$("._show-all-certificates").click(function () {
    $(".certificate-card._new").fadeIn(300)
})

$("._show-all-products").click(function () {
    $(".product-card._new").fadeIn(300)
})

$(".automatization-cases__show-more").click(function () {
    $(".automatization-card._new").fadeIn(300)
})

$(".catalog-spoiler__show").click(function () {
    if(window.innerWidth > 992){
        $(this).parents(".catalog-spoiler").toggleClass("_active")
        $(this).siblings(".catalog-spoiler__hidden").slideToggle()
    }
})

$(".catalog-nav .catalog-spoiler__show").click(function () {
    if(window.innerWidth <= 992){
        $(this).parents(".catalog-spoiler").toggleClass("_active2")
    }
})

$(document).mouseup(function(e) {
    var div = $('.catalog-nav');
    if (!div.is(e.target) && div.has(e.target).length === 0) {
        if($(div).hasClass("_active2")){
            $(div).removeClass("_active2")
        }
    }
});

$(".nav-item__btn").click(function () {
    $(this).parents(".nav-item").toggleClass("_active")
    $(this).parents(".nav-item").find(".nav-item__hidden").slideToggle()
})

$("._show-filter").click(function () {
    $(".filter").addClass("_show")
    $("body").addClass("fixed-body")
})

$("._hide-filter").click(function () {
    $(".filter").removeClass("_show")
    $("body").removeClass("fixed-body")
})


const rangeSlider = document.querySelector(`.range-slider`)
const rangeInput0 = document.querySelector(`.range-slider__input1`)
const rangeInput1 = document.querySelector(`.range-slider__input2`)
const rangeInputs = [rangeInput0, rangeInput1]
if (rangeSlider) {
    let rangeSliderMin = +rangeSlider.getAttribute("data-min")
    let rangeSliderMax = +rangeSlider.getAttribute("data-max")
    let rangeCurrent = +rangeSlider.getAttribute("data-current")
    let rangeCurrent2 = +rangeSlider.getAttribute("data-current2")
    noUiSlider.create(rangeSlider, {
        start: [rangeCurrent, rangeCurrent2],
        connect: true,
        step: 1,
        range: {
            'min': rangeSliderMin,
            'max': rangeSliderMax
        }
    });
}
if (rangeSlider) {
    rangeSlider.noUiSlider.on('update', function(values, handle) {
        rangeInputs[handle].value = Math.round(values[handle])
    })
    rangeInputs.forEach((el, index) => {
        el.addEventListener('change', (e) => {
            setRangeSlider(index, e.currentTarget.value)
        })
    })
}


const setRangeSlider = (i, value) => {
    let array = [null, null];
    array[i] = value;

    rangeSlider.noUiSlider.set(array);
};

$(".props__btn").click(function () {
    $(".props__nav").hide()
    $(".props").addClass("show-all")
})

$(".feedback__btn").click(function () {
    $(".feedback-card._new").fadeIn(300)
})

$("._all-props").click(function () {
    $(".catalog-item2").find("[data-tab='_tab2']").click()
})

$("._add-favourite,._add-comparison").click(function () {
    $(this).toggleClass("_active")
})

$(".lk-order__btn").click(function () {
    $(this).parents(".lk-order").toggleClass("_active")
    $(this).parents(".lk-order").find(".lk-order__bottom").slideToggle()
})

let patternEmailPhone = /\+[0-9]{1,4}[0-9]{1,10}|(.*)@(.*)\.[a-z]{2,5}/
let patternEmail = /^[^ ]+@[^ ]+\.[a-z]{2,3}$/

$("._submit-pass").click(function (e) {
    e.preventDefault()
    let form = $(this).parents("form")
    let pass = $("#pass")
    let pass2 = $("#pass2")
    let pass3 = $("#pass3")

    if(!isFilled(pass)){
        renderError(pass,'_required')
        return
    } else{
        hideError(pass)
    }

    if(!isMin(pass2, 6)){
        renderError(pass2,'_min')
        return
    } else{
        hideError(pass2)
    }

    if(!isFilled(pass3)){
        renderError(pass3,'_required')
        return
    } else{
        hideError(pass3)
    }

    if($(pass2).val() === $(pass3).val()){
        hideError(pass3)
        console.log("form-success")
    } else{
        renderError(pass3,'_not-same')
    }
})

$("._submit-reg").click(function (e) {
    e.preventDefault()
    let login = $("#login")
    let pass = $("#pass")
    let pass2 = $("#pass2")

    if(!isCorrectPattern(login,patternEmailPhone)){
        renderError(login,'_incorrect')
        return
    } else{
        hideError(login)
    }

    if(!isMin(pass, 6)){
        renderError(pass,'_min')
        return
    } else{
        hideError(pass)
    }

    if(!isFilled(pass2)){
        renderError(pass2,'_required')
        return
    } else{
        hideError(pass2)
    }

    if($(pass).val() === $(pass2).val()){
        hideError(pass2)
        console.log("form-success")
    } else{
        renderError(pass2,'_not-same')
    }
})

$("._submit-pass-rec").click(function (e) {
    e.preventDefault()
    let login = $("#login")

    if(!isCorrectPattern(login,patternEmailPhone)){
        renderError(login,'_incorrect')
        return
    } else{
        hideError(login)
        console.log("form-success")
    }
})

$("._submit-pass-rec2").click(function (e) {
    e.preventDefault()
    let pass = $("#pass")
    let pass2 = $("#pass2")


    if(!isMin(pass, 6)){
        renderError(pass,'_min')
        return
    } else{
        hideError(pass)
    }

    if(!isFilled(pass2)){
        renderError(pass2,'_required')
        return
    } else{
        hideError(pass2)
    }

    if($(pass).val() === $(pass2).val()){
        hideError(pass2)
        console.log("form-success")
    } else{
        renderError(pass2,'_not-same')
    }
})

$("._submit-auth").click(function (e) {
    e.preventDefault()
    let login = $("#login")
    let pass = $("#pass")

    if(!isCorrectPattern(login,patternEmailPhone)){
        renderError(login,'_incorrect')
        return
    } else{
        hideError(login)
    }

    if(!isMin(pass, 6)){
        renderError(pass,'_min')
        return
    } else{
        hideError(pass)
        console.log("form-success")
    }
})

$("._submit-order").click(function (e) {
    e.preventDefault()
    let form = $(this).parents("form")
    let name = $(form).find(".name")
    let phone = $(form).find(".phone")
    let email = $(form).find(".email")


    if(!isFilled(name)){
        renderError(name,'_required')
        return
    } else{
        hideError(name)
    }

    if(phone){
        if(!isPhone(phone)){
            renderError(phone,'_incorrect')
            return
        } else{
            hideError(phone)
            if(!email){
                console.log("form-success")
            }
        }
    }


    if(email){
        if(!isCorrectPattern(email,patternEmail)){
            renderError(email,'_incorrect')
            return
        } else{
            hideError(email)
            console.log("form-success")
        }
    }

})

$("._submit-review").click(function (e) {
    e.preventDefault()
    let form = $(this).parents("form")
    let name = $(form).find(".name")
    let email = $(form).find(".email")


    if(!isFilled(name)){
        renderError(name,'_required')
        return
    } else{
        hideError(name)
    }

    if(!isCorrectPattern(email,patternEmail)){
        renderError(email,'_incorrect')
        return
    } else{
        hideError(email)
        console.log("form-success")
    }

})

$("._submit-order2").click(function (e) {
    e.preventDefault()
    let form = $(this).parents("form")
    let name = $(form).find(".name")
    let email = $(form).find(".email")
    let phone = $(form).find(".phone")
    let address = $(form).find(".address")

    if(!isFilled(name)){
        renderError(name,'_required')
        return
    } else{
        hideError(name)
    }

    if(!isCorrectPattern(email,patternEmail)){
        renderError(email,'_incorrect')
        return
    } else{
        hideError(email)
    }

    if(!isPhone(phone)){
        renderError(phone,'_incorrect')
        return
    } else{
        hideError(phone)
    }

    if(!isFilled(address)){
        renderError(address,'_required')
        return
    } else{
        hideError(address)
        console.log("form-success")
    }

})

$("._submit-lk").click(function (e) {
    e.preventDefault()
    let form = $(this).parents("form")
    let phone = $(form).find(".phone")
    let email = $(form).find(".email")


    if(email){
        if(!isCorrectPattern(email,patternEmail)){
            renderError(email,'_incorrect')
            return
        } else{
            hideError(email)
        }
    }

    if(phone){
        if(!isPhone(phone)){
            renderError(phone,'_incorrect')
            return
        } else{
            hideError(phone)
            console.log("form-success")
        }
    }
})


function isCorrectPattern(input,pattern) {
    if($(input).val().match(pattern)){
        return true
    }
    return false
}

function renderError(input,errorName) {
    $(input).parents(".fg").addClass("_error")
    $(input).parents(".fg").find(`.error-item`).removeClass("_active")
    $(input).parents(".fg").find(`.${errorName}`).addClass("_active")
}

function hideError(input) {
    $(input).parents(".fg").removeClass("_error")
    $(input).parents(".fg").find(`.error-item`).removeClass("_active")
}


function isFilled(input) {
    if($(input).val() === ""){
        return false
    }
    return true
}


function isMin(input,min) {
    if($(input).val().trim().length < min){
        return false
    }
    return true
}

function isPhone(input) {
    let val = $(input).val().replace(/[^\w\d]+/gim,"").replace(/[_\s]/g, '')

    if(val.length < 10){
        return false
    }
    return true
}

changeFormBtnState($(".edit .m-check input"))

$(".edit .m-check input").change(function () {
    changeFormBtnState($(this))
})

changeFormBtnState($(".modal-form .m-check input"))

$(".modal-form .m-check input").change(function () {
    changeFormBtnState($(this))
})

function changeFormBtnState(input) {
    let form = $(input).parents("form")
    if($(input).prop("checked")){
        $(form).find("._submit-btn").prop("disabled",false)
    } else{
        $(form).find("._submit-btn").prop("disabled",true)
    }
}

let getScrollBarSize = (function() {
    var el = window.document.createElement('textarea'), style = {
        'visibility': 'hidden', 'position': 'absolute', 'zIndex': '-2147483647',
        'top': '-1000px', 'left': '-1000px', 'width': '1000px', 'height': '1000px',
        'overflow': 'scroll', 'margin': '0', 'border': '0', 'padding': '0'
    }, support = el.clientWidth !== undefined && el.offsetWidth !== undefined;

    for (var key in style) {
        if (style.hasOwnProperty(key)) {
            el.style[key] = style[key];
        }
    }

    return function() {
        var size = null;
        if (support && window.document.body) {
            window.document.body.appendChild(el);
            size = [el.offsetWidth - el.clientWidth, el.offsetHeight - el.clientHeight];
            window.document.body.removeChild(el);
        }
        return size;
    };
})();

$("[data-modal]").click(function () {
    let modalId = $(this).attr("data-modal")
    let modalTitle = $(this).attr("data-title")
    if(modalTitle){
        $("#consultModal2 ._title").html(modalTitle)
        $(".help-modal").removeClass("_active")
    }
    openModal(modalId)
})


function openModal(modalId){
    closeModal()
    $(`#${modalId}`).addClass("modal--active")
    $("body").addClass("fixed-body2")
    $(".fixed-body2").css("padding-right",`${getScrollBarSize()[0]}px`)
}


$("._close-modal").click(function () {
    closeModal()
})

function closeModal() {
    $('.modal').removeClass("modal--active")
    $("body").removeClass("fixed-body2")
    $("body").css("padding-right", "0px")
}



$(".help-modal__top").click(function () {
    $(".help-modal").toggleClass("_active")
})

$(".help-modal ._close-modal").click(function () {
    $(".help-modal").removeClass("_active")
})

sessionStorage.setItem('startTime', Date.now());

const enterTime = sessionStorage.getItem('startTime')

const showPopup = () => {
    let currentTime = Date.now()
    let spentTime = (currentTime - enterTime) / 1000
    if (spentTime >= 60) {
        $(".help-modal").addClass("_active")
        sessionStorage.setItem('startTime', Date.now());
    }
}

const timer = setInterval(showPopup, 1000*61)

$(document).mouseup(function(e) {
    var div = $('.help-modal');
    if (!div.is(e.target) && div.has(e.target).length === 0) {
        if($(div).hasClass("_active")){
            $(div).removeClass("_active")
        }
    }
});

$(".feedback-card__favorite").click(function () {
    let likes = $(this).find(".text16").html()
    if($(this).find(".favourite-btn").hasClass("_added")){
        $(this).find(".text16").html(+likes + 1)
    } else{
        $(this).find(".text16").html(+likes - 1)
    }
})

$(document).ready(function() {
    $('input[type="tel"]').mask('+7 (999) 999 - 99 - 99', { autoclear: false }, { placeholder: '+7 (___) ___ - __ - __' });
    $(".fg select").niceSelect()

    fix100vh()
    $(window).resize(function () {
        fix100vh()
    })
});

function fix100vh() {
    let vh = window.innerHeight * 0.01;
    document.documentElement.style.setProperty('--vh', `${vh}px`);
}



//# sourceMappingURL=../sourcemaps/main.min.js.map
